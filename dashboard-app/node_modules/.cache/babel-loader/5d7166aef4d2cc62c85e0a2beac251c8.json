{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar _regeneratorRuntime = _interopDefault(require('@babel/runtime/regenerator'));\n\nvar _asyncToGenerator = _interopDefault(require('@babel/runtime/helpers/asyncToGenerator'));\n\nvar _objectSpread2 = _interopDefault(require('@babel/runtime/helpers/objectSpread'));\n\nvar _typeof = _interopDefault(require('@babel/runtime/helpers/typeof'));\n\nvar _classCallCheck = _interopDefault(require('@babel/runtime/helpers/classCallCheck'));\n\nvar _createClass = _interopDefault(require('@babel/runtime/helpers/createClass'));\n\nrequire('core-js/modules/es6.promise');\n\nrequire('core-js/modules/es6.object.to-string');\n\nvar uuid = _interopDefault(require('uuid/v4'));\n\nrequire('core-js/modules/es6.number.constructor');\n\nrequire('core-js/modules/es6.number.parse-float');\n\nrequire('core-js/modules/web.dom.iterable');\n\nrequire('core-js/modules/es6.array.iterator');\n\nrequire('core-js/modules/es6.object.keys');\n\nvar _slicedToArray = _interopDefault(require('@babel/runtime/helpers/slicedToArray'));\n\nrequire('core-js/modules/es6.object.assign');\n\nvar _defineProperty = _interopDefault(require('@babel/runtime/helpers/defineProperty'));\n\nrequire('core-js/modules/es6.array.reduce');\n\nrequire('core-js/modules/es6.regexp.match');\n\nrequire('core-js/modules/es6.array.index-of');\n\nrequire('core-js/modules/es6.array.find');\n\nrequire('core-js/modules/es6.array.filter');\n\nvar _objectWithoutProperties = _interopDefault(require('@babel/runtime/helpers/objectWithoutProperties'));\n\nrequire('core-js/modules/es6.string.iterator');\n\nrequire('core-js/modules/es6.array.from');\n\nrequire('core-js/modules/es6.array.map');\n\nvar ramda = require('ramda');\n\nvar Moment = _interopDefault(require('moment'));\n\nvar momentRange = _interopDefault(require('moment-range'));\n\nrequire('core-js/modules/es6.array.is-array');\n\nrequire('core-js/modules/es6.regexp.split');\n\nrequire('core-js/modules/es6.function.name');\n\nrequire('core-js/modules/es6.regexp.to-string');\n\nrequire('core-js/modules/es6.date.to-string');\n\nvar fetch = _interopDefault(require('cross-fetch'));\n\nrequire('url-search-params-polyfill');\n\nvar moment = momentRange.extendMoment(Moment);\nvar TIME_SERIES = {\n  day: function day(range) {\n    return Array.from(range.by('day')).map(function (d) {\n      return d.format('YYYY-MM-DDT00:00:00.000');\n    });\n  },\n  month: function month(range) {\n    return Array.from(range.snapTo('month').by('month')).map(function (d) {\n      return d.format('YYYY-MM-01T00:00:00.000');\n    });\n  },\n  year: function year(range) {\n    return Array.from(range.snapTo('year').by('year')).map(function (d) {\n      return d.format('YYYY-01-01T00:00:00.000');\n    });\n  },\n  hour: function hour(range) {\n    return Array.from(range.by('hour')).map(function (d) {\n      return d.format('YYYY-MM-DDTHH:00:00.000');\n    });\n  },\n  minute: function minute(range) {\n    return Array.from(range.by('minute')).map(function (d) {\n      return d.format('YYYY-MM-DDTHH:mm:00.000');\n    });\n  },\n  second: function second(range) {\n    return Array.from(range.by('second')).map(function (d) {\n      return d.format('YYYY-MM-DDTHH:mm:ss.000');\n    });\n  },\n  week: function week(range) {\n    return Array.from(range.snapTo('isoweek').by('week')).map(function (d) {\n      return d.startOf('isoweek').format('YYYY-MM-DDT00:00:00.000');\n    });\n  }\n};\nvar DateRegex = /^\\d\\d\\d\\d-\\d\\d-\\d\\d$/;\n/**\n * Provides a convenient interface for data manipulation.\n */\n\nvar ResultSet = /*#__PURE__*/function () {\n  function ResultSet(loadResponse) {\n    _classCallCheck(this, ResultSet);\n\n    this.loadResponse = loadResponse;\n  }\n  /**\n   * Returns an array of series with key, title and series data.\n   *\n   * ```js\n   * // For query\n   * {\n   *   measures: ['Stories.count'],\n   *   timeDimensions: [{\n   *     dimension: 'Stories.time',\n   *     dateRange: ['2015-01-01', '2015-12-31'],\n   *     granularity: 'month'\n   *   }]\n   * }\n   *\n   * // ResultSet.series() will return\n   * [\n   *   {\n   *     \"key\":\"Stories.count\",\n   *     \"title\": \"Stories Count\",\n   *     \"series\": [\n   *       { \"x\":\"2015-01-01T00:00:00\", \"value\": 27120 },\n   *       { \"x\":\"2015-02-01T00:00:00\", \"value\": 25861 },\n   *       { \"x\": \"2015-03-01T00:00:00\", \"value\": 29661 },\n   *       //...\n   *     ]\n   *   }\n   * ]\n   * ```\n   * @param pivotConfig\n   * @returns {Array}\n   */\n\n\n  _createClass(ResultSet, [{\n    key: \"series\",\n    value: function series(pivotConfig) {\n      var _this = this;\n\n      return this.seriesNames(pivotConfig).map(function (_ref) {\n        var title = _ref.title,\n            key = _ref.key;\n        return {\n          title: title,\n          key: key,\n          series: _this.chartPivot(pivotConfig).map(function (_ref2) {\n            var category = _ref2.category,\n                x = _ref2.x,\n                obj = _objectWithoutProperties(_ref2, [\"category\", \"x\"]);\n\n            return {\n              value: obj[key],\n              category: category,\n              x: x\n            };\n          })\n        };\n      });\n    }\n  }, {\n    key: \"axisValues\",\n    value: function axisValues(axis) {\n      var query = this.loadResponse.query;\n      return function (row) {\n        var value = function value(measure) {\n          return axis.filter(function (d) {\n            return d !== 'measures';\n          }).map(function (d) {\n            return row[d] != null ? row[d] : null;\n          }).concat(measure ? [measure] : []);\n        };\n\n        if (axis.find(function (d) {\n          return d === 'measures';\n        }) && (query.measures || []).length) {\n          return query.measures.map(value);\n        }\n\n        return [value()];\n      };\n    }\n  }, {\n    key: \"axisValuesString\",\n    value: function axisValuesString(axisValues, delimiter) {\n      var formatValue = function formatValue(v) {\n        if (v == null) {\n          return 'âˆ…';\n        } else if (v === '') {\n          return '[Empty string]';\n        } else {\n          return v;\n        }\n      };\n\n      return axisValues.map(formatValue).join(delimiter || ', ');\n    }\n  }, {\n    key: \"normalizePivotConfig\",\n    value: function normalizePivotConfig(pivotConfig) {\n      var query = this.loadResponse.query;\n      var timeDimensions = (query.timeDimensions || []).filter(function (td) {\n        return !!td.granularity;\n      });\n      var dimensions = query.dimensions || [];\n      pivotConfig = pivotConfig || (timeDimensions.length ? {\n        x: timeDimensions.map(function (td) {\n          return ResultSet.timeDimensionMember(td);\n        }),\n        y: dimensions\n      } : {\n        x: dimensions,\n        y: []\n      });\n\n      var substituteTimeDimensionMembers = function substituteTimeDimensionMembers(axis) {\n        return axis.map(function (subDim) {\n          return timeDimensions.find(function (td) {\n            return td.dimension === subDim;\n          }) && !dimensions.find(function (d) {\n            return d === subDim;\n          }) ? ResultSet.timeDimensionMember(query.timeDimensions.find(function (td) {\n            return td.dimension === subDim;\n          })) : subDim;\n        });\n      };\n\n      pivotConfig.x = substituteTimeDimensionMembers(pivotConfig.x || []);\n      pivotConfig.y = substituteTimeDimensionMembers(pivotConfig.y || []);\n      var allIncludedDimensions = pivotConfig.x.concat(pivotConfig.y);\n      var allDimensions = timeDimensions.map(function (td) {\n        return ResultSet.timeDimensionMember(td);\n      }).concat(dimensions);\n      pivotConfig.x = pivotConfig.x.concat(allDimensions.filter(function (d) {\n        return allIncludedDimensions.indexOf(d) === -1;\n      }));\n\n      if (!pivotConfig.x.concat(pivotConfig.y).find(function (d) {\n        return d === 'measures';\n      })) {\n        pivotConfig.y = pivotConfig.y.concat(['measures']);\n      }\n\n      if (!(query.measures || []).length) {\n        pivotConfig.x = pivotConfig.x.filter(function (d) {\n          return d !== 'measures';\n        });\n        pivotConfig.y = pivotConfig.y.filter(function (d) {\n          return d !== 'measures';\n        });\n      }\n\n      if (pivotConfig.fillMissingDates == null) {\n        pivotConfig.fillMissingDates = true;\n      }\n\n      return pivotConfig;\n    }\n  }, {\n    key: \"timeSeries\",\n    value: function timeSeries(timeDimension) {\n      if (!timeDimension.granularity) {\n        return null;\n      }\n\n      var dateRange = timeDimension.dateRange;\n\n      if (!dateRange) {\n        var dates = ramda.pipe(ramda.map(function (row) {\n          return row[ResultSet.timeDimensionMember(timeDimension)] && moment(row[ResultSet.timeDimensionMember(timeDimension)]);\n        }), ramda.filter(function (r) {\n          return !!r;\n        }))(this.timeDimensionBackwardCompatibleData());\n        dateRange = dates.length && [ramda.reduce(ramda.minBy(function (d) {\n          return d.toDate();\n        }), dates[0], dates), ramda.reduce(ramda.maxBy(function (d) {\n          return d.toDate();\n        }), dates[0], dates)] || null;\n      }\n\n      if (!dateRange) {\n        return null;\n      }\n\n      var padToDay = timeDimension.dateRange ? timeDimension.dateRange.find(function (d) {\n        return d.match(DateRegex);\n      }) : ['hour', 'minute', 'second'].indexOf(timeDimension.granularity) === -1;\n      var start = moment(dateRange[0]).format(padToDay ? 'YYYY-MM-DDT00:00:00.000' : moment.HTML5_FMT.DATETIME_LOCAL_MS);\n      var end = moment(dateRange[1]).format(padToDay ? 'YYYY-MM-DDT23:59:59.999' : moment.HTML5_FMT.DATETIME_LOCAL_MS);\n      var range = moment.range(start, end);\n\n      if (!TIME_SERIES[timeDimension.granularity]) {\n        throw new Error(\"Unsupported time granularity: \".concat(timeDimension.granularity));\n      }\n\n      return TIME_SERIES[timeDimension.granularity](range);\n    }\n  }, {\n    key: \"pivot\",\n    value: function pivot(pivotConfig) {\n      var _this2 = this;\n\n      pivotConfig = this.normalizePivotConfig(pivotConfig);\n      var groupByXAxis = ramda.groupBy(function (_ref3) {\n        var xValues = _ref3.xValues;\n        return _this2.axisValuesString(xValues);\n      }); // eslint-disable-next-line no-unused-vars\n\n      var measureValue = function measureValue(row, measure, xValues) {\n        return row[measure];\n      };\n\n      if (pivotConfig.fillMissingDates && pivotConfig.x.length === 1 && ramda.equals(pivotConfig.x, (this.loadResponse.query.timeDimensions || []).filter(function (td) {\n        return !!td.granularity;\n      }).map(function (td) {\n        return ResultSet.timeDimensionMember(td);\n      }))) {\n        var series = this.timeSeries(this.loadResponse.query.timeDimensions[0]);\n\n        if (series) {\n          groupByXAxis = function groupByXAxis(rows) {\n            var byXValues = ramda.groupBy(function (_ref4) {\n              var xValues = _ref4.xValues;\n              return moment(xValues[0]).format(moment.HTML5_FMT.DATETIME_LOCAL_MS);\n            }, rows);\n            return series.map(function (d) {\n              return _defineProperty({}, d, byXValues[d] || [{\n                xValues: [d],\n                row: {}\n              }]);\n            }).reduce(function (a, b) {\n              return Object.assign(a, b);\n            }, {});\n          }; // eslint-disable-next-line no-unused-vars\n\n\n          measureValue = function measureValue(row, measure, xValues) {\n            return row[measure] || 0;\n          };\n        }\n      }\n\n      var xGrouped = ramda.pipe(ramda.map(function (row) {\n        return _this2.axisValues(pivotConfig.x)(row).map(function (xValues) {\n          return {\n            xValues: xValues,\n            row: row\n          };\n        });\n      }), ramda.unnest, groupByXAxis, ramda.toPairs)(this.timeDimensionBackwardCompatibleData());\n      var allYValues = ramda.pipe(ramda.map( // eslint-disable-next-line no-unused-vars\n      function (_ref6) {\n        var _ref7 = _slicedToArray(_ref6, 2),\n            xValuesString = _ref7[0],\n            rows = _ref7[1];\n\n        return ramda.unnest( // collect Y values only from filled rows\n        rows.filter(function (_ref8) {\n          var row = _ref8.row;\n          return Object.keys(row).length > 0;\n        }).map(function (_ref9) {\n          var row = _ref9.row;\n          return _this2.axisValues(pivotConfig.y)(row);\n        }));\n      }), ramda.unnest, ramda.uniq)(xGrouped); // eslint-disable-next-line no-unused-vars\n\n      return xGrouped.map(function (_ref10) {\n        var _ref11 = _slicedToArray(_ref10, 2),\n            xValuesString = _ref11[0],\n            rows = _ref11[1];\n\n        var xValues = rows[0].xValues;\n        var yGrouped = ramda.pipe(ramda.map(function (_ref12) {\n          var row = _ref12.row;\n          return _this2.axisValues(pivotConfig.y)(row).map(function (yValues) {\n            return {\n              yValues: yValues,\n              row: row\n            };\n          });\n        }), ramda.unnest, ramda.groupBy(function (_ref13) {\n          var yValues = _ref13.yValues;\n          return _this2.axisValuesString(yValues);\n        }))(rows);\n        return {\n          xValues: xValues,\n          yValuesArray: ramda.unnest(allYValues.map(function (yValues) {\n            var measure = pivotConfig.x.find(function (d) {\n              return d === 'measures';\n            }) ? ResultSet.measureFromAxis(xValues) : ResultSet.measureFromAxis(yValues);\n            return (yGrouped[_this2.axisValuesString(yValues)] || [{\n              row: {}\n            }]).map(function (_ref14) {\n              var row = _ref14.row;\n              return [yValues, measureValue(row, measure, xValues)];\n            });\n          }))\n        };\n      });\n    }\n  }, {\n    key: \"pivotedRows\",\n    value: function pivotedRows(pivotConfig) {\n      // TODO\n      return this.chartPivot(pivotConfig);\n    }\n    /**\n     * Returns normalized query result data in the following format.\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.chartPivot() will return\n     * [\n     *   { \"x\":\"2015-01-01T00:00:00\", \"Stories.count\": 27120 },\n     *   { \"x\":\"2015-02-01T00:00:00\", \"Stories.count\": 25861 },\n     *   { \"x\": \"2015-03-01T00:00:00\", \"Stories.count\": 29661 },\n     *   //...\n     * ]\n     * ```\n     * @param pivotConfig\n     */\n\n  }, {\n    key: \"chartPivot\",\n    value: function chartPivot(pivotConfig) {\n      var _this3 = this;\n\n      return this.pivot(pivotConfig).map(function (_ref15) {\n        var xValues = _ref15.xValues,\n            yValuesArray = _ref15.yValuesArray;\n        return _objectSpread2({\n          category: _this3.axisValuesString(xValues, ', '),\n          // TODO deprecated\n          x: _this3.axisValuesString(xValues, ', ')\n        }, yValuesArray.map(function (_ref16) {\n          var _ref17 = _slicedToArray(_ref16, 2),\n              yValues = _ref17[0],\n              m = _ref17[1];\n\n          return _defineProperty({}, _this3.axisValuesString(yValues, ', '), m && Number.parseFloat(m));\n        }).reduce(function (a, b) {\n          return Object.assign(a, b);\n        }, {}));\n      });\n    }\n    /**\n     * Returns normalized query result data prepared for visualization in the table format.\n     *\n     * For example\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.tablePivot() will return\n     * [\n     *   { \"Stories.time\": \"2015-01-01T00:00:00\", \"Stories.count\": 27120 },\n     *   { \"Stories.time\": \"2015-02-01T00:00:00\", \"Stories.count\": 25861 },\n     *   { \"Stories.time\": \"2015-03-01T00:00:00\", \"Stories.count\": 29661 },\n     *   //...\n     * ]\n     * ```\n     * @param pivotConfig\n     * @returns {Array} of pivoted rows\n     */\n\n  }, {\n    key: \"tablePivot\",\n    value: function tablePivot(pivotConfig) {\n      var normalizedPivotConfig = this.normalizePivotConfig(pivotConfig || {});\n\n      var valueToObject = function valueToObject(valuesArray, measureValue) {\n        return function (field, index) {\n          return _defineProperty({}, field === 'measures' ? valuesArray[index] : field, field === 'measures' ? measureValue : valuesArray[index]);\n        };\n      };\n\n      return this.pivot(normalizedPivotConfig).map(function (_ref20) {\n        var xValues = _ref20.xValues,\n            yValuesArray = _ref20.yValuesArray;\n        return yValuesArray.map(function (_ref21) {\n          var _ref22 = _slicedToArray(_ref21, 2),\n              yValues = _ref22[0],\n              m = _ref22[1];\n\n          return normalizedPivotConfig.x.map(valueToObject(xValues, m)).concat(normalizedPivotConfig.y.map(valueToObject(yValues, m))).reduce(function (a, b) {\n            return Object.assign(a, b);\n          }, {});\n        }).reduce(function (a, b) {\n          return Object.assign(a, b);\n        }, {});\n      });\n    }\n    /**\n     * Returns array of column definitions for `tablePivot`.\n     *\n     * For example\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.tableColumns() will return\n     * [\n     *   { key: \"Stories.time\", title: \"Stories Time\", shortTitle: \"Time\" },\n     *   { key: \"Stories.count\", title: \"Stories Count\", shortTitle: \"Count\" },\n     *   //...\n     * ]\n     * ```\n     * @param pivotConfig\n     * @returns {Array} of columns\n     */\n\n  }, {\n    key: \"tableColumns\",\n    value: function tableColumns(pivotConfig) {\n      var _this4 = this;\n\n      var normalizedPivotConfig = this.normalizePivotConfig(pivotConfig);\n\n      var column = function column(field) {\n        return field === 'measures' ? (_this4.query().measures || []).map(function (m) {\n          return {\n            key: m,\n            title: _this4.loadResponse.annotation.measures[m].title,\n            shortTitle: _this4.loadResponse.annotation.measures[m].shortTitle\n          };\n        }) : [{\n          key: field,\n          title: (_this4.loadResponse.annotation.dimensions[field] || _this4.loadResponse.annotation.timeDimensions[field]).title,\n          shortTitle: (_this4.loadResponse.annotation.dimensions[field] || _this4.loadResponse.annotation.timeDimensions[field]).shortTitle\n        }];\n      };\n\n      return normalizedPivotConfig.x.map(column).concat(normalizedPivotConfig.y.map(column)).reduce(function (a, b) {\n        return a.concat(b);\n      });\n    }\n  }, {\n    key: \"totalRow\",\n    value: function totalRow() {\n      return this.chartPivot()[0];\n    }\n  }, {\n    key: \"categories\",\n    value: function categories(pivotConfig) {\n      // TODO\n      return this.chartPivot(pivotConfig);\n    }\n    /**\n     * Returns the array of series objects, containing `key` and `title` parameters.\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.seriesNames() will return\n     * [\n     * { \"key\":\"Stories.count\", \"title\": \"Stories Count\" }\n     * ]\n     * ```\n     * @param pivotConfig\n     * @returns {Array} of series names\n     */\n\n  }, {\n    key: \"seriesNames\",\n    value: function seriesNames(pivotConfig) {\n      var _this5 = this;\n\n      pivotConfig = this.normalizePivotConfig(pivotConfig);\n      return ramda.pipe(ramda.map(this.axisValues(pivotConfig.y)), ramda.unnest, ramda.uniq)(this.timeDimensionBackwardCompatibleData()).map(function (axisValues) {\n        return {\n          title: _this5.axisValuesString(pivotConfig.y.find(function (d) {\n            return d === 'measures';\n          }) ? ramda.dropLast(1, axisValues).concat(_this5.loadResponse.annotation.measures[ResultSet.measureFromAxis(axisValues)].title) : axisValues, ', '),\n          key: _this5.axisValuesString(axisValues)\n        };\n      });\n    }\n  }, {\n    key: \"query\",\n    value: function query() {\n      return this.loadResponse.query;\n    }\n  }, {\n    key: \"rawData\",\n    value: function rawData() {\n      return this.loadResponse.data;\n    }\n  }, {\n    key: \"timeDimensionBackwardCompatibleData\",\n    value: function timeDimensionBackwardCompatibleData() {\n      if (!this.backwardCompatibleData) {\n        var query = this.loadResponse.query;\n        var timeDimensions = (query.timeDimensions || []).filter(function (td) {\n          return !!td.granularity;\n        });\n        this.backwardCompatibleData = this.loadResponse.data.map(function (row) {\n          return _objectSpread2({}, row, {}, Object.keys(row).filter(function (field) {\n            return timeDimensions.find(function (d) {\n              return d.dimension === field;\n            }) && !row[ResultSet.timeDimensionMember(timeDimensions.find(function (d) {\n              return d.dimension === field;\n            }))];\n          }).map(function (field) {\n            return _defineProperty({}, ResultSet.timeDimensionMember(timeDimensions.find(function (d) {\n              return d.dimension === field;\n            })), row[field]);\n          }).reduce(function (a, b) {\n            return _objectSpread2({}, a, {}, b);\n          }, {}));\n        });\n      }\n\n      return this.backwardCompatibleData;\n    }\n  }], [{\n    key: \"timeDimensionMember\",\n    value: function timeDimensionMember(td) {\n      return \"\".concat(td.dimension, \".\").concat(td.granularity);\n    }\n  }, {\n    key: \"measureFromAxis\",\n    value: function measureFromAxis(axisValues) {\n      return axisValues[axisValues.length - 1];\n    }\n  }]);\n\n  return ResultSet;\n}();\n\nvar SqlQuery = /*#__PURE__*/function () {\n  function SqlQuery(sqlQuery) {\n    _classCallCheck(this, SqlQuery);\n\n    this.sqlQuery = sqlQuery;\n  }\n\n  _createClass(SqlQuery, [{\n    key: \"rawQuery\",\n    value: function rawQuery() {\n      return this.sqlQuery.sql;\n    }\n  }, {\n    key: \"sql\",\n    value: function sql() {\n      return this.rawQuery().sql[0];\n    }\n  }]);\n\n  return SqlQuery;\n}();\n\nvar memberMap = function memberMap(memberArray) {\n  return ramda.fromPairs(memberArray.map(function (m) {\n    return [m.name, m];\n  }));\n};\n\nvar operators = {\n  string: [{\n    name: 'contains',\n    title: 'contains'\n  }, {\n    name: 'notContains',\n    title: 'does not contain'\n  }, {\n    name: 'equals',\n    title: 'equals'\n  }, {\n    name: 'notEquals',\n    title: 'does not equal'\n  }, {\n    name: 'set',\n    title: 'is set'\n  }, {\n    name: 'notSet',\n    title: 'is not set'\n  }],\n  number: [{\n    name: 'equals',\n    title: 'equals'\n  }, {\n    name: 'notEquals',\n    title: 'does not equal'\n  }, {\n    name: 'set',\n    title: 'is set'\n  }, {\n    name: 'notSet',\n    title: 'is not set'\n  }, {\n    name: 'gt',\n    title: '>'\n  }, {\n    name: 'gte',\n    title: '>='\n  }, {\n    name: 'lt',\n    title: '<'\n  }, {\n    name: 'lte',\n    title: '<='\n  }]\n};\n\nvar Meta = /*#__PURE__*/function () {\n  function Meta(metaResponse) {\n    _classCallCheck(this, Meta);\n\n    this.meta = metaResponse;\n    var cubes = this.meta.cubes;\n    this.cubes = cubes;\n    this.cubesMap = ramda.fromPairs(cubes.map(function (c) {\n      return [c.name, {\n        measures: memberMap(c.measures),\n        dimensions: memberMap(c.dimensions),\n        segments: memberMap(c.segments)\n      }];\n    }));\n  }\n\n  _createClass(Meta, [{\n    key: \"membersForQuery\",\n    value: function membersForQuery(query, memberType) {\n      return ramda.unnest(this.cubes.map(function (c) {\n        return c[memberType];\n      }));\n    }\n  }, {\n    key: \"resolveMember\",\n    value: function resolveMember(memberName, memberType) {\n      var _this = this;\n\n      var _memberName$split = memberName.split('.'),\n          _memberName$split2 = _slicedToArray(_memberName$split, 1),\n          cube = _memberName$split2[0];\n\n      if (!this.cubesMap[cube]) {\n        return {\n          title: memberName,\n          error: \"Cube not found \".concat(cube, \" for path '\").concat(memberName, \"'\")\n        };\n      }\n\n      var memberTypes = Array.isArray(memberType) ? memberType : [memberType];\n      var member = memberTypes.map(function (type) {\n        return _this.cubesMap[cube][type] && _this.cubesMap[cube][type][memberName];\n      }).find(function (m) {\n        return m;\n      });\n\n      if (!member) {\n        return {\n          title: memberName,\n          error: \"Path not found '\".concat(memberName, \"'\")\n        };\n      }\n\n      return member;\n    }\n  }, {\n    key: \"defaultTimeDimensionNameFor\",\n    value: function defaultTimeDimensionNameFor(memberName) {\n      var _this2 = this;\n\n      var _memberName$split3 = memberName.split('.'),\n          _memberName$split4 = _slicedToArray(_memberName$split3, 1),\n          cube = _memberName$split4[0];\n\n      if (!this.cubesMap[cube]) {\n        return null;\n      }\n\n      return Object.keys(this.cubesMap[cube].dimensions || {}).find(function (d) {\n        return _this2.cubesMap[cube].dimensions[d].type === 'time';\n      });\n    }\n  }, {\n    key: \"filterOperatorsForMember\",\n    value: function filterOperatorsForMember(memberName, memberType) {\n      var member = this.resolveMember(memberName, memberType);\n      return operators[member.type] || operators.string;\n    }\n  }]);\n\n  return Meta;\n}();\n\nvar ProgressResult = /*#__PURE__*/function () {\n  function ProgressResult(progressResponse) {\n    _classCallCheck(this, ProgressResult);\n\n    this.progressResponse = progressResponse;\n  }\n\n  _createClass(ProgressResult, [{\n    key: \"stage\",\n    value: function stage() {\n      return this.progressResponse.stage;\n    }\n  }, {\n    key: \"timeElapsed\",\n    value: function timeElapsed() {\n      return this.progressResponse.timeElapsed;\n    }\n  }]);\n\n  return ProgressResult;\n}();\n\nvar HttpTransport = /*#__PURE__*/function () {\n  function HttpTransport(_ref) {\n    var authorization = _ref.authorization,\n        apiUrl = _ref.apiUrl,\n        _ref$headers = _ref.headers,\n        headers = _ref$headers === void 0 ? {} : _ref$headers;\n\n    _classCallCheck(this, HttpTransport);\n\n    this.authorization = authorization;\n    this.apiUrl = apiUrl;\n    this.headers = headers;\n  }\n\n  _createClass(HttpTransport, [{\n    key: \"request\",\n    value: function request(method, _ref2) {\n      var _this = this;\n\n      var baseRequestId = _ref2.baseRequestId,\n          params = _objectWithoutProperties(_ref2, [\"baseRequestId\"]);\n\n      var searchParams = new URLSearchParams(params && Object.keys(params).map(function (k) {\n        return _defineProperty({}, k, _typeof(params[k]) === 'object' ? JSON.stringify(params[k]) : params[k]);\n      }).reduce(function (a, b) {\n        return _objectSpread2({}, a, {}, b);\n      }, {}));\n      var spanCounter = 1;\n\n      var runRequest = function runRequest() {\n        return fetch(\"\".concat(_this.apiUrl, \"/\").concat(method).concat(searchParams.toString().length ? \"?\".concat(searchParams) : ''), {\n          headers: _objectSpread2({\n            Authorization: _this.authorization,\n            'Content-Type': 'application/json',\n            'x-request-id': baseRequestId && \"\".concat(baseRequestId, \"-span-\").concat(spanCounter++)\n          }, _this.headers)\n        });\n      };\n\n      return {\n        subscribe: function subscribe(callback) {\n          var _this2 = this;\n\n          return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n            var result;\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    _context.next = 2;\n                    return runRequest();\n\n                  case 2:\n                    result = _context.sent;\n                    return _context.abrupt(\"return\", callback(result, function () {\n                      return _this2.subscribe(callback);\n                    }));\n\n                  case 4:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          }))();\n        }\n      };\n    }\n  }]);\n\n  return HttpTransport;\n}();\n\nvar API_URL = \"https://statsbot.co/cubejs-api/v1\";\nvar mutexCounter = 0;\nvar MUTEX_ERROR = 'Mutex has been changed';\n\nvar mutexPromise = function mutexPromise(promise) {\n  return new Promise(function (resolve, reject) {\n    promise.then(function (r) {\n      return resolve(r);\n    }, function (e) {\n      return e !== MUTEX_ERROR && reject(e);\n    });\n  });\n};\n/**\n * Main class for accessing Cube.js API\n * @order -5\n */\n\n\nvar CubejsApi = /*#__PURE__*/function () {\n  function CubejsApi(apiToken, options) {\n    _classCallCheck(this, CubejsApi);\n\n    if (_typeof(apiToken) === 'object') {\n      options = apiToken;\n      apiToken = undefined;\n    }\n\n    options = options || {};\n    this.apiToken = apiToken;\n    this.apiUrl = options.apiUrl || API_URL;\n    this.headers = options.headers || {};\n    this.transport = options.transport || new HttpTransport({\n      authorization: typeof apiToken === 'function' ? undefined : apiToken,\n      apiUrl: this.apiUrl,\n      headers: this.headers\n    });\n    this.pollInterval = options.pollInterval || 5;\n  }\n\n  _createClass(CubejsApi, [{\n    key: \"request\",\n    value: function request(method, params) {\n      return this.transport.request(method, _objectSpread2({\n        baseRequestId: uuid()\n      }, params));\n    }\n  }, {\n    key: \"loadMethod\",\n    value: function loadMethod(request, toResult, options, callback) {\n      var _this = this;\n\n      var mutexValue = ++mutexCounter;\n\n      if (typeof options === 'function' && !callback) {\n        callback = options;\n        options = undefined;\n      }\n\n      options = options || {};\n      var mutexKey = options.mutexKey || 'default';\n\n      if (options.mutexObj) {\n        options.mutexObj[mutexKey] = mutexValue;\n      }\n\n      var requestPromise = this.updateTransportAuthorization().then(function () {\n        return request();\n      });\n      var unsubscribed = false;\n\n      var checkMutex = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var requestInstance;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return requestPromise;\n\n                case 2:\n                  requestInstance = _context.sent;\n\n                  if (!(options.mutexObj && options.mutexObj[mutexKey] !== mutexValue)) {\n                    _context.next = 9;\n                    break;\n                  }\n\n                  unsubscribed = true;\n\n                  if (!requestInstance.unsubscribe) {\n                    _context.next = 8;\n                    break;\n                  }\n\n                  _context.next = 8;\n                  return requestInstance.unsubscribe();\n\n                case 8:\n                  throw MUTEX_ERROR;\n\n                case 9:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function checkMutex() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      var loadImpl = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(response, next) {\n          var requestInstance, subscribeNext, continueWait, body, error, result;\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.next = 2;\n                  return requestPromise;\n\n                case 2:\n                  requestInstance = _context4.sent;\n\n                  subscribeNext = /*#__PURE__*/function () {\n                    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                        while (1) {\n                          switch (_context2.prev = _context2.next) {\n                            case 0:\n                              if (!(options.subscribe && !unsubscribed)) {\n                                _context2.next = 8;\n                                break;\n                              }\n\n                              if (!requestInstance.unsubscribe) {\n                                _context2.next = 5;\n                                break;\n                              }\n\n                              return _context2.abrupt(\"return\", next());\n\n                            case 5:\n                              _context2.next = 7;\n                              return new Promise(function (resolve) {\n                                return setTimeout(function () {\n                                  return resolve();\n                                }, _this.pollInterval * 1000);\n                              });\n\n                            case 7:\n                              return _context2.abrupt(\"return\", next());\n\n                            case 8:\n                              return _context2.abrupt(\"return\", null);\n\n                            case 9:\n                            case \"end\":\n                              return _context2.stop();\n                          }\n                        }\n                      }, _callee2);\n                    }));\n\n                    return function subscribeNext() {\n                      return _ref3.apply(this, arguments);\n                    };\n                  }();\n\n                  continueWait = /*#__PURE__*/function () {\n                    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(wait) {\n                      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                        while (1) {\n                          switch (_context3.prev = _context3.next) {\n                            case 0:\n                              if (unsubscribed) {\n                                _context3.next = 5;\n                                break;\n                              }\n\n                              if (!wait) {\n                                _context3.next = 4;\n                                break;\n                              }\n\n                              _context3.next = 4;\n                              return new Promise(function (resolve) {\n                                return setTimeout(function () {\n                                  return resolve();\n                                }, _this.pollInterval * 1000);\n                              });\n\n                            case 4:\n                              return _context3.abrupt(\"return\", next());\n\n                            case 5:\n                              return _context3.abrupt(\"return\", null);\n\n                            case 6:\n                            case \"end\":\n                              return _context3.stop();\n                          }\n                        }\n                      }, _callee3);\n                    }));\n\n                    return function continueWait(_x3) {\n                      return _ref4.apply(this, arguments);\n                    };\n                  }();\n\n                  _context4.next = 7;\n                  return _this.updateTransportAuthorization();\n\n                case 7:\n                  if (!(response.status === 502)) {\n                    _context4.next = 11;\n                    break;\n                  }\n\n                  _context4.next = 10;\n                  return checkMutex();\n\n                case 10:\n                  return _context4.abrupt(\"return\", continueWait(true));\n\n                case 11:\n                  _context4.next = 13;\n                  return response.json();\n\n                case 13:\n                  body = _context4.sent;\n\n                  if (!(body.error === 'Continue wait')) {\n                    _context4.next = 19;\n                    break;\n                  }\n\n                  _context4.next = 17;\n                  return checkMutex();\n\n                case 17:\n                  if (options.progressCallback) {\n                    options.progressCallback(new ProgressResult(body));\n                  }\n\n                  return _context4.abrupt(\"return\", continueWait());\n\n                case 19:\n                  if (!(response.status !== 200)) {\n                    _context4.next = 32;\n                    break;\n                  }\n\n                  _context4.next = 22;\n                  return checkMutex();\n\n                case 22:\n                  if (!(!options.subscribe && requestInstance.unsubscribe)) {\n                    _context4.next = 25;\n                    break;\n                  }\n\n                  _context4.next = 25;\n                  return requestInstance.unsubscribe();\n\n                case 25:\n                  error = new Error(body.error); // TODO error class\n\n                  if (!callback) {\n                    _context4.next = 30;\n                    break;\n                  }\n\n                  callback(error);\n                  _context4.next = 31;\n                  break;\n\n                case 30:\n                  throw error;\n\n                case 31:\n                  return _context4.abrupt(\"return\", subscribeNext());\n\n                case 32:\n                  _context4.next = 34;\n                  return checkMutex();\n\n                case 34:\n                  if (!(!options.subscribe && requestInstance.unsubscribe)) {\n                    _context4.next = 37;\n                    break;\n                  }\n\n                  _context4.next = 37;\n                  return requestInstance.unsubscribe();\n\n                case 37:\n                  result = toResult(body);\n\n                  if (!callback) {\n                    _context4.next = 42;\n                    break;\n                  }\n\n                  callback(null, result);\n                  _context4.next = 43;\n                  break;\n\n                case 42:\n                  return _context4.abrupt(\"return\", result);\n\n                case 43:\n                  return _context4.abrupt(\"return\", subscribeNext());\n\n                case 44:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        return function loadImpl(_x, _x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      var promise = requestPromise.then(function (requestInstance) {\n        return mutexPromise(requestInstance.subscribe(loadImpl));\n      });\n\n      if (callback) {\n        return {\n          unsubscribe: function () {\n            var _unsubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n              var requestInstance;\n              return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                while (1) {\n                  switch (_context5.prev = _context5.next) {\n                    case 0:\n                      _context5.next = 2;\n                      return requestPromise;\n\n                    case 2:\n                      requestInstance = _context5.sent;\n                      unsubscribed = true;\n\n                      if (!requestInstance.unsubscribe) {\n                        _context5.next = 6;\n                        break;\n                      }\n\n                      return _context5.abrupt(\"return\", requestInstance.unsubscribe());\n\n                    case 6:\n                      return _context5.abrupt(\"return\", null);\n\n                    case 7:\n                    case \"end\":\n                      return _context5.stop();\n                  }\n                }\n              }, _callee5);\n            }));\n\n            function unsubscribe() {\n              return _unsubscribe.apply(this, arguments);\n            }\n\n            return unsubscribe;\n          }()\n        };\n      } else {\n        return promise;\n      }\n    }\n  }, {\n    key: \"updateTransportAuthorization\",\n    value: function () {\n      var _updateTransportAuthorization = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var token;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!(typeof this.apiToken === 'function')) {\n                  _context6.next = 5;\n                  break;\n                }\n\n                _context6.next = 3;\n                return this.apiToken();\n\n              case 3:\n                token = _context6.sent;\n\n                if (this.transport.authorization !== token) {\n                  this.transport.authorization = token;\n                }\n\n              case 5:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function updateTransportAuthorization() {\n        return _updateTransportAuthorization.apply(this, arguments);\n      }\n\n      return updateTransportAuthorization;\n    }()\n    /**\n     * Fetch data for passed `query`.\n     *\n     * ```js\n     * import cubejs from '@cubejs-client/core';\n     * import Chart from 'chart.js';\n     * import chartjsConfig from './toChartjsData';\n     *\n     * const cubejsApi = cubejs('CUBEJS_TOKEN');\n     *\n     * const resultSet = await cubejsApi.load({\n     *  measures: ['Stories.count'],\n     *  timeDimensions: [{\n     *    dimension: 'Stories.time',\n     *    dateRange: ['2015-01-01', '2015-12-31'],\n     *    granularity: 'month'\n     *   }]\n     * });\n     *\n     * const context = document.getElementById('myChart');\n     * new Chart(context, chartjsConfig(resultSet));\n     * ```\n     * @param query - [Query object](query-format)\n     * @param options\n     * @param callback\n     * @returns {Promise} for {@link ResultSet} if `callback` isn't passed\n     */\n\n  }, {\n    key: \"load\",\n    value: function load(query, options, callback) {\n      var _this2 = this;\n\n      return this.loadMethod(function () {\n        return _this2.request(\"load\", {\n          query: query\n        });\n      }, function (body) {\n        return new ResultSet(body);\n      }, options, callback);\n    }\n    /**\n     * Get generated SQL string for given `query`.\n     * @param query - [Query object](query-format)\n     * @param options\n     * @param callback\n     * @return {Promise} for {@link SqlQuery} if `callback` isn't passed\n     */\n\n  }, {\n    key: \"sql\",\n    value: function sql(query, options, callback) {\n      var _this3 = this;\n\n      return this.loadMethod(function () {\n        return _this3.request(\"sql\", {\n          query: query\n        });\n      }, function (body) {\n        return new SqlQuery(body);\n      }, options, callback);\n    }\n    /**\n     * Get meta description of cubes available for querying.\n     * @param options\n     * @param callback\n     * @return {Promise} for {@link Meta} if `callback` isn't passed\n     */\n\n  }, {\n    key: \"meta\",\n    value: function meta(options, callback) {\n      var _this4 = this;\n\n      return this.loadMethod(function () {\n        return _this4.request(\"meta\");\n      }, function (body) {\n        return new Meta(body);\n      }, options, callback);\n    }\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(query, options, callback) {\n      var _this5 = this;\n\n      return this.loadMethod(function () {\n        return _this5.request(\"subscribe\", {\n          query: query\n        });\n      }, function (body) {\n        return new ResultSet(body);\n      }, _objectSpread2({}, options, {\n        subscribe: true\n      }), callback);\n    }\n  }]);\n\n  return CubejsApi;\n}();\n/**\n * Create instance of `CubejsApi`.\n * API entry point.\n *\n * ```javascript\n import cubejs from '@cubejs-client/core';\n\n const cubejsApi = cubejs(\n 'CUBEJS-API-TOKEN',\n { apiUrl: 'http://localhost:4000/cubejs-api/v1' }\n );\n ```\n * @name cubejs\n * @param apiToken - [API token](security) is used to authorize requests and determine SQL database you're accessing.\n * In the development mode, Cube.js Backend will print the API token to the console on on startup.\n * Can be an async function without arguments that returns API token.\n * @param options - options object.\n * @param options.apiUrl - URL of your Cube.js Backend.\n * By default, in the development environment it is `http://localhost:4000/cubejs-api/v1`.\n * @returns {CubejsApi}\n * @order -10\n */\n\n\nvar index = function (apiToken, options) {\n  return new CubejsApi(apiToken, options);\n};\n\nexports.default = index;\nexports.HttpTransport = HttpTransport;","map":{"version":3,"sources":["/home/syb234/dashboard/dashboard-backend/dashboard-app/node_modules/@cubejs-client/core/dist/cubejs-client-core.js"],"names":["Object","defineProperty","exports","value","_interopDefault","ex","_regeneratorRuntime","require","_asyncToGenerator","_objectSpread2","_typeof","_classCallCheck","_createClass","uuid","_slicedToArray","_defineProperty","_objectWithoutProperties","ramda","Moment","momentRange","fetch","moment","extendMoment","TIME_SERIES","day","range","Array","from","by","map","d","format","month","snapTo","year","hour","minute","second","week","startOf","DateRegex","ResultSet","loadResponse","key","series","pivotConfig","_this","seriesNames","_ref","title","chartPivot","_ref2","category","x","obj","axisValues","axis","query","row","measure","filter","concat","find","measures","length","axisValuesString","delimiter","formatValue","v","join","normalizePivotConfig","timeDimensions","td","granularity","dimensions","timeDimensionMember","y","substituteTimeDimensionMembers","subDim","dimension","allIncludedDimensions","allDimensions","indexOf","fillMissingDates","timeSeries","timeDimension","dateRange","dates","pipe","r","timeDimensionBackwardCompatibleData","reduce","minBy","toDate","maxBy","padToDay","match","start","HTML5_FMT","DATETIME_LOCAL_MS","end","Error","pivot","_this2","groupByXAxis","groupBy","_ref3","xValues","measureValue","equals","rows","byXValues","_ref4","a","b","assign","xGrouped","unnest","toPairs","allYValues","_ref6","_ref7","xValuesString","_ref8","keys","_ref9","uniq","_ref10","_ref11","yGrouped","_ref12","yValues","_ref13","yValuesArray","measureFromAxis","_ref14","pivotedRows","_this3","_ref15","_ref16","_ref17","m","Number","parseFloat","tablePivot","normalizedPivotConfig","valueToObject","valuesArray","field","index","_ref20","_ref21","_ref22","tableColumns","_this4","column","annotation","shortTitle","totalRow","categories","_this5","dropLast","rawData","data","backwardCompatibleData","SqlQuery","sqlQuery","rawQuery","sql","memberMap","memberArray","fromPairs","name","operators","string","number","Meta","metaResponse","meta","cubes","cubesMap","c","segments","membersForQuery","memberType","resolveMember","memberName","_memberName$split","split","_memberName$split2","cube","error","memberTypes","isArray","member","type","defaultTimeDimensionNameFor","_memberName$split3","_memberName$split4","filterOperatorsForMember","ProgressResult","progressResponse","stage","timeElapsed","HttpTransport","authorization","apiUrl","_ref$headers","headers","request","method","baseRequestId","params","searchParams","URLSearchParams","k","JSON","stringify","spanCounter","runRequest","toString","Authorization","subscribe","callback","mark","_callee","result","wrap","_callee$","_context","prev","next","sent","abrupt","stop","API_URL","mutexCounter","MUTEX_ERROR","mutexPromise","promise","Promise","resolve","reject","then","e","CubejsApi","apiToken","options","undefined","transport","pollInterval","loadMethod","toResult","mutexValue","mutexKey","mutexObj","requestPromise","updateTransportAuthorization","unsubscribed","checkMutex","requestInstance","unsubscribe","apply","arguments","loadImpl","_callee4","response","subscribeNext","continueWait","body","_callee4$","_context4","_callee2","_callee2$","_context2","setTimeout","_callee3","wait","_callee3$","_context3","_x3","status","json","progressCallback","_x","_x2","_unsubscribe","_callee5","_callee5$","_context5","_updateTransportAuthorization","_callee6","token","_callee6$","_context6","load","default"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar _regeneratorRuntime = _interopDefault(require('@babel/runtime/regenerator'));\nrequire('regenerator-runtime/runtime');\nvar _asyncToGenerator = _interopDefault(require('@babel/runtime/helpers/asyncToGenerator'));\nvar _objectSpread2 = _interopDefault(require('@babel/runtime/helpers/objectSpread'));\nvar _typeof = _interopDefault(require('@babel/runtime/helpers/typeof'));\nvar _classCallCheck = _interopDefault(require('@babel/runtime/helpers/classCallCheck'));\nvar _createClass = _interopDefault(require('@babel/runtime/helpers/createClass'));\nrequire('core-js/modules/es6.promise');\nrequire('core-js/modules/es6.object.to-string');\nvar uuid = _interopDefault(require('uuid/v4'));\nrequire('core-js/modules/es6.number.constructor');\nrequire('core-js/modules/es6.number.parse-float');\nrequire('core-js/modules/web.dom.iterable');\nrequire('core-js/modules/es6.array.iterator');\nrequire('core-js/modules/es6.object.keys');\nvar _slicedToArray = _interopDefault(require('@babel/runtime/helpers/slicedToArray'));\nrequire('core-js/modules/es6.object.assign');\nvar _defineProperty = _interopDefault(require('@babel/runtime/helpers/defineProperty'));\nrequire('core-js/modules/es6.array.reduce');\nrequire('core-js/modules/es6.regexp.match');\nrequire('core-js/modules/es6.array.index-of');\nrequire('core-js/modules/es6.array.find');\nrequire('core-js/modules/es6.array.filter');\nvar _objectWithoutProperties = _interopDefault(require('@babel/runtime/helpers/objectWithoutProperties'));\nrequire('core-js/modules/es6.string.iterator');\nrequire('core-js/modules/es6.array.from');\nrequire('core-js/modules/es6.array.map');\nvar ramda = require('ramda');\nvar Moment = _interopDefault(require('moment'));\nvar momentRange = _interopDefault(require('moment-range'));\nrequire('core-js/modules/es6.array.is-array');\nrequire('core-js/modules/es6.regexp.split');\nrequire('core-js/modules/es6.function.name');\nrequire('core-js/modules/es6.regexp.to-string');\nrequire('core-js/modules/es6.date.to-string');\nvar fetch = _interopDefault(require('cross-fetch'));\nrequire('url-search-params-polyfill');\n\nvar moment = momentRange.extendMoment(Moment);\nvar TIME_SERIES = {\n  day: function day(range) {\n    return Array.from(range.by('day')).map(function (d) {\n      return d.format('YYYY-MM-DDT00:00:00.000');\n    });\n  },\n  month: function month(range) {\n    return Array.from(range.snapTo('month').by('month')).map(function (d) {\n      return d.format('YYYY-MM-01T00:00:00.000');\n    });\n  },\n  year: function year(range) {\n    return Array.from(range.snapTo('year').by('year')).map(function (d) {\n      return d.format('YYYY-01-01T00:00:00.000');\n    });\n  },\n  hour: function hour(range) {\n    return Array.from(range.by('hour')).map(function (d) {\n      return d.format('YYYY-MM-DDTHH:00:00.000');\n    });\n  },\n  minute: function minute(range) {\n    return Array.from(range.by('minute')).map(function (d) {\n      return d.format('YYYY-MM-DDTHH:mm:00.000');\n    });\n  },\n  second: function second(range) {\n    return Array.from(range.by('second')).map(function (d) {\n      return d.format('YYYY-MM-DDTHH:mm:ss.000');\n    });\n  },\n  week: function week(range) {\n    return Array.from(range.snapTo('isoweek').by('week')).map(function (d) {\n      return d.startOf('isoweek').format('YYYY-MM-DDT00:00:00.000');\n    });\n  }\n};\nvar DateRegex = /^\\d\\d\\d\\d-\\d\\d-\\d\\d$/;\n/**\n * Provides a convenient interface for data manipulation.\n */\n\nvar ResultSet =\n/*#__PURE__*/\nfunction () {\n  function ResultSet(loadResponse) {\n    _classCallCheck(this, ResultSet);\n\n    this.loadResponse = loadResponse;\n  }\n  /**\n   * Returns an array of series with key, title and series data.\n   *\n   * ```js\n   * // For query\n   * {\n   *   measures: ['Stories.count'],\n   *   timeDimensions: [{\n   *     dimension: 'Stories.time',\n   *     dateRange: ['2015-01-01', '2015-12-31'],\n   *     granularity: 'month'\n   *   }]\n   * }\n   *\n   * // ResultSet.series() will return\n   * [\n   *   {\n   *     \"key\":\"Stories.count\",\n   *     \"title\": \"Stories Count\",\n   *     \"series\": [\n   *       { \"x\":\"2015-01-01T00:00:00\", \"value\": 27120 },\n   *       { \"x\":\"2015-02-01T00:00:00\", \"value\": 25861 },\n   *       { \"x\": \"2015-03-01T00:00:00\", \"value\": 29661 },\n   *       //...\n   *     ]\n   *   }\n   * ]\n   * ```\n   * @param pivotConfig\n   * @returns {Array}\n   */\n\n\n  _createClass(ResultSet, [{\n    key: \"series\",\n    value: function series(pivotConfig) {\n      var _this = this;\n\n      return this.seriesNames(pivotConfig).map(function (_ref) {\n        var title = _ref.title,\n            key = _ref.key;\n        return {\n          title: title,\n          key: key,\n          series: _this.chartPivot(pivotConfig).map(function (_ref2) {\n            var category = _ref2.category,\n                x = _ref2.x,\n                obj = _objectWithoutProperties(_ref2, [\"category\", \"x\"]);\n\n            return {\n              value: obj[key],\n              category: category,\n              x: x\n            };\n          })\n        };\n      });\n    }\n  }, {\n    key: \"axisValues\",\n    value: function axisValues(axis) {\n      var query = this.loadResponse.query;\n      return function (row) {\n        var value = function value(measure) {\n          return axis.filter(function (d) {\n            return d !== 'measures';\n          }).map(function (d) {\n            return row[d] != null ? row[d] : null;\n          }).concat(measure ? [measure] : []);\n        };\n\n        if (axis.find(function (d) {\n          return d === 'measures';\n        }) && (query.measures || []).length) {\n          return query.measures.map(value);\n        }\n\n        return [value()];\n      };\n    }\n  }, {\n    key: \"axisValuesString\",\n    value: function axisValuesString(axisValues, delimiter) {\n      var formatValue = function formatValue(v) {\n        if (v == null) {\n          return 'âˆ…';\n        } else if (v === '') {\n          return '[Empty string]';\n        } else {\n          return v;\n        }\n      };\n\n      return axisValues.map(formatValue).join(delimiter || ', ');\n    }\n  }, {\n    key: \"normalizePivotConfig\",\n    value: function normalizePivotConfig(pivotConfig) {\n      var query = this.loadResponse.query;\n      var timeDimensions = (query.timeDimensions || []).filter(function (td) {\n        return !!td.granularity;\n      });\n      var dimensions = query.dimensions || [];\n      pivotConfig = pivotConfig || (timeDimensions.length ? {\n        x: timeDimensions.map(function (td) {\n          return ResultSet.timeDimensionMember(td);\n        }),\n        y: dimensions\n      } : {\n        x: dimensions,\n        y: []\n      });\n\n      var substituteTimeDimensionMembers = function substituteTimeDimensionMembers(axis) {\n        return axis.map(function (subDim) {\n          return timeDimensions.find(function (td) {\n            return td.dimension === subDim;\n          }) && !dimensions.find(function (d) {\n            return d === subDim;\n          }) ? ResultSet.timeDimensionMember(query.timeDimensions.find(function (td) {\n            return td.dimension === subDim;\n          })) : subDim;\n        });\n      };\n\n      pivotConfig.x = substituteTimeDimensionMembers(pivotConfig.x || []);\n      pivotConfig.y = substituteTimeDimensionMembers(pivotConfig.y || []);\n      var allIncludedDimensions = pivotConfig.x.concat(pivotConfig.y);\n      var allDimensions = timeDimensions.map(function (td) {\n        return ResultSet.timeDimensionMember(td);\n      }).concat(dimensions);\n      pivotConfig.x = pivotConfig.x.concat(allDimensions.filter(function (d) {\n        return allIncludedDimensions.indexOf(d) === -1;\n      }));\n\n      if (!pivotConfig.x.concat(pivotConfig.y).find(function (d) {\n        return d === 'measures';\n      })) {\n        pivotConfig.y = pivotConfig.y.concat(['measures']);\n      }\n\n      if (!(query.measures || []).length) {\n        pivotConfig.x = pivotConfig.x.filter(function (d) {\n          return d !== 'measures';\n        });\n        pivotConfig.y = pivotConfig.y.filter(function (d) {\n          return d !== 'measures';\n        });\n      }\n\n      if (pivotConfig.fillMissingDates == null) {\n        pivotConfig.fillMissingDates = true;\n      }\n\n      return pivotConfig;\n    }\n  }, {\n    key: \"timeSeries\",\n    value: function timeSeries(timeDimension) {\n      if (!timeDimension.granularity) {\n        return null;\n      }\n\n      var dateRange = timeDimension.dateRange;\n\n      if (!dateRange) {\n        var dates = ramda.pipe(ramda.map(function (row) {\n          return row[ResultSet.timeDimensionMember(timeDimension)] && moment(row[ResultSet.timeDimensionMember(timeDimension)]);\n        }), ramda.filter(function (r) {\n          return !!r;\n        }))(this.timeDimensionBackwardCompatibleData());\n        dateRange = dates.length && [ramda.reduce(ramda.minBy(function (d) {\n          return d.toDate();\n        }), dates[0], dates), ramda.reduce(ramda.maxBy(function (d) {\n          return d.toDate();\n        }), dates[0], dates)] || null;\n      }\n\n      if (!dateRange) {\n        return null;\n      }\n\n      var padToDay = timeDimension.dateRange ? timeDimension.dateRange.find(function (d) {\n        return d.match(DateRegex);\n      }) : ['hour', 'minute', 'second'].indexOf(timeDimension.granularity) === -1;\n      var start = moment(dateRange[0]).format(padToDay ? 'YYYY-MM-DDT00:00:00.000' : moment.HTML5_FMT.DATETIME_LOCAL_MS);\n      var end = moment(dateRange[1]).format(padToDay ? 'YYYY-MM-DDT23:59:59.999' : moment.HTML5_FMT.DATETIME_LOCAL_MS);\n      var range = moment.range(start, end);\n\n      if (!TIME_SERIES[timeDimension.granularity]) {\n        throw new Error(\"Unsupported time granularity: \".concat(timeDimension.granularity));\n      }\n\n      return TIME_SERIES[timeDimension.granularity](range);\n    }\n  }, {\n    key: \"pivot\",\n    value: function pivot(pivotConfig) {\n      var _this2 = this;\n\n      pivotConfig = this.normalizePivotConfig(pivotConfig);\n      var groupByXAxis = ramda.groupBy(function (_ref3) {\n        var xValues = _ref3.xValues;\n        return _this2.axisValuesString(xValues);\n      }); // eslint-disable-next-line no-unused-vars\n\n      var measureValue = function measureValue(row, measure, xValues) {\n        return row[measure];\n      };\n\n      if (pivotConfig.fillMissingDates && pivotConfig.x.length === 1 && ramda.equals(pivotConfig.x, (this.loadResponse.query.timeDimensions || []).filter(function (td) {\n        return !!td.granularity;\n      }).map(function (td) {\n        return ResultSet.timeDimensionMember(td);\n      }))) {\n        var series = this.timeSeries(this.loadResponse.query.timeDimensions[0]);\n\n        if (series) {\n          groupByXAxis = function groupByXAxis(rows) {\n            var byXValues = ramda.groupBy(function (_ref4) {\n              var xValues = _ref4.xValues;\n              return moment(xValues[0]).format(moment.HTML5_FMT.DATETIME_LOCAL_MS);\n            }, rows);\n            return series.map(function (d) {\n              return _defineProperty({}, d, byXValues[d] || [{\n                xValues: [d],\n                row: {}\n              }]);\n            }).reduce(function (a, b) {\n              return Object.assign(a, b);\n            }, {});\n          }; // eslint-disable-next-line no-unused-vars\n\n\n          measureValue = function measureValue(row, measure, xValues) {\n            return row[measure] || 0;\n          };\n        }\n      }\n\n      var xGrouped = ramda.pipe(ramda.map(function (row) {\n        return _this2.axisValues(pivotConfig.x)(row).map(function (xValues) {\n          return {\n            xValues: xValues,\n            row: row\n          };\n        });\n      }), ramda.unnest, groupByXAxis, ramda.toPairs)(this.timeDimensionBackwardCompatibleData());\n      var allYValues = ramda.pipe(ramda.map( // eslint-disable-next-line no-unused-vars\n      function (_ref6) {\n        var _ref7 = _slicedToArray(_ref6, 2),\n            xValuesString = _ref7[0],\n            rows = _ref7[1];\n\n        return ramda.unnest( // collect Y values only from filled rows\n        rows.filter(function (_ref8) {\n          var row = _ref8.row;\n          return Object.keys(row).length > 0;\n        }).map(function (_ref9) {\n          var row = _ref9.row;\n          return _this2.axisValues(pivotConfig.y)(row);\n        }));\n      }), ramda.unnest, ramda.uniq)(xGrouped); // eslint-disable-next-line no-unused-vars\n\n      return xGrouped.map(function (_ref10) {\n        var _ref11 = _slicedToArray(_ref10, 2),\n            xValuesString = _ref11[0],\n            rows = _ref11[1];\n\n        var xValues = rows[0].xValues;\n        var yGrouped = ramda.pipe(ramda.map(function (_ref12) {\n          var row = _ref12.row;\n          return _this2.axisValues(pivotConfig.y)(row).map(function (yValues) {\n            return {\n              yValues: yValues,\n              row: row\n            };\n          });\n        }), ramda.unnest, ramda.groupBy(function (_ref13) {\n          var yValues = _ref13.yValues;\n          return _this2.axisValuesString(yValues);\n        }))(rows);\n        return {\n          xValues: xValues,\n          yValuesArray: ramda.unnest(allYValues.map(function (yValues) {\n            var measure = pivotConfig.x.find(function (d) {\n              return d === 'measures';\n            }) ? ResultSet.measureFromAxis(xValues) : ResultSet.measureFromAxis(yValues);\n            return (yGrouped[_this2.axisValuesString(yValues)] || [{\n              row: {}\n            }]).map(function (_ref14) {\n              var row = _ref14.row;\n              return [yValues, measureValue(row, measure, xValues)];\n            });\n          }))\n        };\n      });\n    }\n  }, {\n    key: \"pivotedRows\",\n    value: function pivotedRows(pivotConfig) {\n      // TODO\n      return this.chartPivot(pivotConfig);\n    }\n    /**\n     * Returns normalized query result data in the following format.\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.chartPivot() will return\n     * [\n     *   { \"x\":\"2015-01-01T00:00:00\", \"Stories.count\": 27120 },\n     *   { \"x\":\"2015-02-01T00:00:00\", \"Stories.count\": 25861 },\n     *   { \"x\": \"2015-03-01T00:00:00\", \"Stories.count\": 29661 },\n     *   //...\n     * ]\n     * ```\n     * @param pivotConfig\n     */\n\n  }, {\n    key: \"chartPivot\",\n    value: function chartPivot(pivotConfig) {\n      var _this3 = this;\n\n      return this.pivot(pivotConfig).map(function (_ref15) {\n        var xValues = _ref15.xValues,\n            yValuesArray = _ref15.yValuesArray;\n        return _objectSpread2({\n          category: _this3.axisValuesString(xValues, ', '),\n          // TODO deprecated\n          x: _this3.axisValuesString(xValues, ', ')\n        }, yValuesArray.map(function (_ref16) {\n          var _ref17 = _slicedToArray(_ref16, 2),\n              yValues = _ref17[0],\n              m = _ref17[1];\n\n          return _defineProperty({}, _this3.axisValuesString(yValues, ', '), m && Number.parseFloat(m));\n        }).reduce(function (a, b) {\n          return Object.assign(a, b);\n        }, {}));\n      });\n    }\n    /**\n     * Returns normalized query result data prepared for visualization in the table format.\n     *\n     * For example\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.tablePivot() will return\n     * [\n     *   { \"Stories.time\": \"2015-01-01T00:00:00\", \"Stories.count\": 27120 },\n     *   { \"Stories.time\": \"2015-02-01T00:00:00\", \"Stories.count\": 25861 },\n     *   { \"Stories.time\": \"2015-03-01T00:00:00\", \"Stories.count\": 29661 },\n     *   //...\n     * ]\n     * ```\n     * @param pivotConfig\n     * @returns {Array} of pivoted rows\n     */\n\n  }, {\n    key: \"tablePivot\",\n    value: function tablePivot(pivotConfig) {\n      var normalizedPivotConfig = this.normalizePivotConfig(pivotConfig || {});\n\n      var valueToObject = function valueToObject(valuesArray, measureValue) {\n        return function (field, index) {\n          return _defineProperty({}, field === 'measures' ? valuesArray[index] : field, field === 'measures' ? measureValue : valuesArray[index]);\n        };\n      };\n\n      return this.pivot(normalizedPivotConfig).map(function (_ref20) {\n        var xValues = _ref20.xValues,\n            yValuesArray = _ref20.yValuesArray;\n        return yValuesArray.map(function (_ref21) {\n          var _ref22 = _slicedToArray(_ref21, 2),\n              yValues = _ref22[0],\n              m = _ref22[1];\n\n          return normalizedPivotConfig.x.map(valueToObject(xValues, m)).concat(normalizedPivotConfig.y.map(valueToObject(yValues, m))).reduce(function (a, b) {\n            return Object.assign(a, b);\n          }, {});\n        }).reduce(function (a, b) {\n          return Object.assign(a, b);\n        }, {});\n      });\n    }\n    /**\n     * Returns array of column definitions for `tablePivot`.\n     *\n     * For example\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.tableColumns() will return\n     * [\n     *   { key: \"Stories.time\", title: \"Stories Time\", shortTitle: \"Time\" },\n     *   { key: \"Stories.count\", title: \"Stories Count\", shortTitle: \"Count\" },\n     *   //...\n     * ]\n     * ```\n     * @param pivotConfig\n     * @returns {Array} of columns\n     */\n\n  }, {\n    key: \"tableColumns\",\n    value: function tableColumns(pivotConfig) {\n      var _this4 = this;\n\n      var normalizedPivotConfig = this.normalizePivotConfig(pivotConfig);\n\n      var column = function column(field) {\n        return field === 'measures' ? (_this4.query().measures || []).map(function (m) {\n          return {\n            key: m,\n            title: _this4.loadResponse.annotation.measures[m].title,\n            shortTitle: _this4.loadResponse.annotation.measures[m].shortTitle\n          };\n        }) : [{\n          key: field,\n          title: (_this4.loadResponse.annotation.dimensions[field] || _this4.loadResponse.annotation.timeDimensions[field]).title,\n          shortTitle: (_this4.loadResponse.annotation.dimensions[field] || _this4.loadResponse.annotation.timeDimensions[field]).shortTitle\n        }];\n      };\n\n      return normalizedPivotConfig.x.map(column).concat(normalizedPivotConfig.y.map(column)).reduce(function (a, b) {\n        return a.concat(b);\n      });\n    }\n  }, {\n    key: \"totalRow\",\n    value: function totalRow() {\n      return this.chartPivot()[0];\n    }\n  }, {\n    key: \"categories\",\n    value: function categories(pivotConfig) {\n      // TODO\n      return this.chartPivot(pivotConfig);\n    }\n    /**\n     * Returns the array of series objects, containing `key` and `title` parameters.\n     *\n     * ```js\n     * // For query\n     * {\n     *   measures: ['Stories.count'],\n     *   timeDimensions: [{\n     *     dimension: 'Stories.time',\n     *     dateRange: ['2015-01-01', '2015-12-31'],\n     *     granularity: 'month'\n     *   }]\n     * }\n     *\n     * // ResultSet.seriesNames() will return\n     * [\n     * { \"key\":\"Stories.count\", \"title\": \"Stories Count\" }\n     * ]\n     * ```\n     * @param pivotConfig\n     * @returns {Array} of series names\n     */\n\n  }, {\n    key: \"seriesNames\",\n    value: function seriesNames(pivotConfig) {\n      var _this5 = this;\n\n      pivotConfig = this.normalizePivotConfig(pivotConfig);\n      return ramda.pipe(ramda.map(this.axisValues(pivotConfig.y)), ramda.unnest, ramda.uniq)(this.timeDimensionBackwardCompatibleData()).map(function (axisValues) {\n        return {\n          title: _this5.axisValuesString(pivotConfig.y.find(function (d) {\n            return d === 'measures';\n          }) ? ramda.dropLast(1, axisValues).concat(_this5.loadResponse.annotation.measures[ResultSet.measureFromAxis(axisValues)].title) : axisValues, ', '),\n          key: _this5.axisValuesString(axisValues)\n        };\n      });\n    }\n  }, {\n    key: \"query\",\n    value: function query() {\n      return this.loadResponse.query;\n    }\n  }, {\n    key: \"rawData\",\n    value: function rawData() {\n      return this.loadResponse.data;\n    }\n  }, {\n    key: \"timeDimensionBackwardCompatibleData\",\n    value: function timeDimensionBackwardCompatibleData() {\n      if (!this.backwardCompatibleData) {\n        var query = this.loadResponse.query;\n        var timeDimensions = (query.timeDimensions || []).filter(function (td) {\n          return !!td.granularity;\n        });\n        this.backwardCompatibleData = this.loadResponse.data.map(function (row) {\n          return _objectSpread2({}, row, {}, Object.keys(row).filter(function (field) {\n            return timeDimensions.find(function (d) {\n              return d.dimension === field;\n            }) && !row[ResultSet.timeDimensionMember(timeDimensions.find(function (d) {\n              return d.dimension === field;\n            }))];\n          }).map(function (field) {\n            return _defineProperty({}, ResultSet.timeDimensionMember(timeDimensions.find(function (d) {\n              return d.dimension === field;\n            })), row[field]);\n          }).reduce(function (a, b) {\n            return _objectSpread2({}, a, {}, b);\n          }, {}));\n        });\n      }\n\n      return this.backwardCompatibleData;\n    }\n  }], [{\n    key: \"timeDimensionMember\",\n    value: function timeDimensionMember(td) {\n      return \"\".concat(td.dimension, \".\").concat(td.granularity);\n    }\n  }, {\n    key: \"measureFromAxis\",\n    value: function measureFromAxis(axisValues) {\n      return axisValues[axisValues.length - 1];\n    }\n  }]);\n\n  return ResultSet;\n}();\n\nvar SqlQuery =\n/*#__PURE__*/\nfunction () {\n  function SqlQuery(sqlQuery) {\n    _classCallCheck(this, SqlQuery);\n\n    this.sqlQuery = sqlQuery;\n  }\n\n  _createClass(SqlQuery, [{\n    key: \"rawQuery\",\n    value: function rawQuery() {\n      return this.sqlQuery.sql;\n    }\n  }, {\n    key: \"sql\",\n    value: function sql() {\n      return this.rawQuery().sql[0];\n    }\n  }]);\n\n  return SqlQuery;\n}();\n\nvar memberMap = function memberMap(memberArray) {\n  return ramda.fromPairs(memberArray.map(function (m) {\n    return [m.name, m];\n  }));\n};\n\nvar operators = {\n  string: [{\n    name: 'contains',\n    title: 'contains'\n  }, {\n    name: 'notContains',\n    title: 'does not contain'\n  }, {\n    name: 'equals',\n    title: 'equals'\n  }, {\n    name: 'notEquals',\n    title: 'does not equal'\n  }, {\n    name: 'set',\n    title: 'is set'\n  }, {\n    name: 'notSet',\n    title: 'is not set'\n  }],\n  number: [{\n    name: 'equals',\n    title: 'equals'\n  }, {\n    name: 'notEquals',\n    title: 'does not equal'\n  }, {\n    name: 'set',\n    title: 'is set'\n  }, {\n    name: 'notSet',\n    title: 'is not set'\n  }, {\n    name: 'gt',\n    title: '>'\n  }, {\n    name: 'gte',\n    title: '>='\n  }, {\n    name: 'lt',\n    title: '<'\n  }, {\n    name: 'lte',\n    title: '<='\n  }]\n};\n\nvar Meta =\n/*#__PURE__*/\nfunction () {\n  function Meta(metaResponse) {\n    _classCallCheck(this, Meta);\n\n    this.meta = metaResponse;\n    var cubes = this.meta.cubes;\n    this.cubes = cubes;\n    this.cubesMap = ramda.fromPairs(cubes.map(function (c) {\n      return [c.name, {\n        measures: memberMap(c.measures),\n        dimensions: memberMap(c.dimensions),\n        segments: memberMap(c.segments)\n      }];\n    }));\n  }\n\n  _createClass(Meta, [{\n    key: \"membersForQuery\",\n    value: function membersForQuery(query, memberType) {\n      return ramda.unnest(this.cubes.map(function (c) {\n        return c[memberType];\n      }));\n    }\n  }, {\n    key: \"resolveMember\",\n    value: function resolveMember(memberName, memberType) {\n      var _this = this;\n\n      var _memberName$split = memberName.split('.'),\n          _memberName$split2 = _slicedToArray(_memberName$split, 1),\n          cube = _memberName$split2[0];\n\n      if (!this.cubesMap[cube]) {\n        return {\n          title: memberName,\n          error: \"Cube not found \".concat(cube, \" for path '\").concat(memberName, \"'\")\n        };\n      }\n\n      var memberTypes = Array.isArray(memberType) ? memberType : [memberType];\n      var member = memberTypes.map(function (type) {\n        return _this.cubesMap[cube][type] && _this.cubesMap[cube][type][memberName];\n      }).find(function (m) {\n        return m;\n      });\n\n      if (!member) {\n        return {\n          title: memberName,\n          error: \"Path not found '\".concat(memberName, \"'\")\n        };\n      }\n\n      return member;\n    }\n  }, {\n    key: \"defaultTimeDimensionNameFor\",\n    value: function defaultTimeDimensionNameFor(memberName) {\n      var _this2 = this;\n\n      var _memberName$split3 = memberName.split('.'),\n          _memberName$split4 = _slicedToArray(_memberName$split3, 1),\n          cube = _memberName$split4[0];\n\n      if (!this.cubesMap[cube]) {\n        return null;\n      }\n\n      return Object.keys(this.cubesMap[cube].dimensions || {}).find(function (d) {\n        return _this2.cubesMap[cube].dimensions[d].type === 'time';\n      });\n    }\n  }, {\n    key: \"filterOperatorsForMember\",\n    value: function filterOperatorsForMember(memberName, memberType) {\n      var member = this.resolveMember(memberName, memberType);\n      return operators[member.type] || operators.string;\n    }\n  }]);\n\n  return Meta;\n}();\n\nvar ProgressResult =\n/*#__PURE__*/\nfunction () {\n  function ProgressResult(progressResponse) {\n    _classCallCheck(this, ProgressResult);\n\n    this.progressResponse = progressResponse;\n  }\n\n  _createClass(ProgressResult, [{\n    key: \"stage\",\n    value: function stage() {\n      return this.progressResponse.stage;\n    }\n  }, {\n    key: \"timeElapsed\",\n    value: function timeElapsed() {\n      return this.progressResponse.timeElapsed;\n    }\n  }]);\n\n  return ProgressResult;\n}();\n\nvar HttpTransport =\n/*#__PURE__*/\nfunction () {\n  function HttpTransport(_ref) {\n    var authorization = _ref.authorization,\n        apiUrl = _ref.apiUrl,\n        _ref$headers = _ref.headers,\n        headers = _ref$headers === void 0 ? {} : _ref$headers;\n\n    _classCallCheck(this, HttpTransport);\n\n    this.authorization = authorization;\n    this.apiUrl = apiUrl;\n    this.headers = headers;\n  }\n\n  _createClass(HttpTransport, [{\n    key: \"request\",\n    value: function request(method, _ref2) {\n      var _this = this;\n\n      var baseRequestId = _ref2.baseRequestId,\n          params = _objectWithoutProperties(_ref2, [\"baseRequestId\"]);\n\n      var searchParams = new URLSearchParams(params && Object.keys(params).map(function (k) {\n        return _defineProperty({}, k, _typeof(params[k]) === 'object' ? JSON.stringify(params[k]) : params[k]);\n      }).reduce(function (a, b) {\n        return _objectSpread2({}, a, {}, b);\n      }, {}));\n      var spanCounter = 1;\n\n      var runRequest = function runRequest() {\n        return fetch(\"\".concat(_this.apiUrl, \"/\").concat(method).concat(searchParams.toString().length ? \"?\".concat(searchParams) : ''), {\n          headers: _objectSpread2({\n            Authorization: _this.authorization,\n            'Content-Type': 'application/json',\n            'x-request-id': baseRequestId && \"\".concat(baseRequestId, \"-span-\").concat(spanCounter++)\n          }, _this.headers)\n        });\n      };\n\n      return {\n        subscribe: function subscribe(callback) {\n          var _this2 = this;\n\n          return _asyncToGenerator(\n          /*#__PURE__*/\n          _regeneratorRuntime.mark(function _callee() {\n            var result;\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    _context.next = 2;\n                    return runRequest();\n\n                  case 2:\n                    result = _context.sent;\n                    return _context.abrupt(\"return\", callback(result, function () {\n                      return _this2.subscribe(callback);\n                    }));\n\n                  case 4:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          }))();\n        }\n      };\n    }\n  }]);\n\n  return HttpTransport;\n}();\n\nvar API_URL = \"https://statsbot.co/cubejs-api/v1\";\nvar mutexCounter = 0;\nvar MUTEX_ERROR = 'Mutex has been changed';\n\nvar mutexPromise = function mutexPromise(promise) {\n  return new Promise(function (resolve, reject) {\n    promise.then(function (r) {\n      return resolve(r);\n    }, function (e) {\n      return e !== MUTEX_ERROR && reject(e);\n    });\n  });\n};\n/**\n * Main class for accessing Cube.js API\n * @order -5\n */\n\n\nvar CubejsApi =\n/*#__PURE__*/\nfunction () {\n  function CubejsApi(apiToken, options) {\n    _classCallCheck(this, CubejsApi);\n\n    if (_typeof(apiToken) === 'object') {\n      options = apiToken;\n      apiToken = undefined;\n    }\n\n    options = options || {};\n    this.apiToken = apiToken;\n    this.apiUrl = options.apiUrl || API_URL;\n    this.headers = options.headers || {};\n    this.transport = options.transport || new HttpTransport({\n      authorization: typeof apiToken === 'function' ? undefined : apiToken,\n      apiUrl: this.apiUrl,\n      headers: this.headers\n    });\n    this.pollInterval = options.pollInterval || 5;\n  }\n\n  _createClass(CubejsApi, [{\n    key: \"request\",\n    value: function request(method, params) {\n      return this.transport.request(method, _objectSpread2({\n        baseRequestId: uuid()\n      }, params));\n    }\n  }, {\n    key: \"loadMethod\",\n    value: function loadMethod(request, toResult, options, callback) {\n      var _this = this;\n\n      var mutexValue = ++mutexCounter;\n\n      if (typeof options === 'function' && !callback) {\n        callback = options;\n        options = undefined;\n      }\n\n      options = options || {};\n      var mutexKey = options.mutexKey || 'default';\n\n      if (options.mutexObj) {\n        options.mutexObj[mutexKey] = mutexValue;\n      }\n\n      var requestPromise = this.updateTransportAuthorization().then(function () {\n        return request();\n      });\n      var unsubscribed = false;\n\n      var checkMutex =\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee() {\n          var requestInstance;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return requestPromise;\n\n                case 2:\n                  requestInstance = _context.sent;\n\n                  if (!(options.mutexObj && options.mutexObj[mutexKey] !== mutexValue)) {\n                    _context.next = 9;\n                    break;\n                  }\n\n                  unsubscribed = true;\n\n                  if (!requestInstance.unsubscribe) {\n                    _context.next = 8;\n                    break;\n                  }\n\n                  _context.next = 8;\n                  return requestInstance.unsubscribe();\n\n                case 8:\n                  throw MUTEX_ERROR;\n\n                case 9:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function checkMutex() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      var loadImpl =\n      /*#__PURE__*/\n      function () {\n        var _ref2 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee4(response, next) {\n          var requestInstance, subscribeNext, continueWait, body, error, result;\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.next = 2;\n                  return requestPromise;\n\n                case 2:\n                  requestInstance = _context4.sent;\n\n                  subscribeNext =\n                  /*#__PURE__*/\n                  function () {\n                    var _ref3 = _asyncToGenerator(\n                    /*#__PURE__*/\n                    _regeneratorRuntime.mark(function _callee2() {\n                      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                        while (1) {\n                          switch (_context2.prev = _context2.next) {\n                            case 0:\n                              if (!(options.subscribe && !unsubscribed)) {\n                                _context2.next = 8;\n                                break;\n                              }\n\n                              if (!requestInstance.unsubscribe) {\n                                _context2.next = 5;\n                                break;\n                              }\n\n                              return _context2.abrupt(\"return\", next());\n\n                            case 5:\n                              _context2.next = 7;\n                              return new Promise(function (resolve) {\n                                return setTimeout(function () {\n                                  return resolve();\n                                }, _this.pollInterval * 1000);\n                              });\n\n                            case 7:\n                              return _context2.abrupt(\"return\", next());\n\n                            case 8:\n                              return _context2.abrupt(\"return\", null);\n\n                            case 9:\n                            case \"end\":\n                              return _context2.stop();\n                          }\n                        }\n                      }, _callee2);\n                    }));\n\n                    return function subscribeNext() {\n                      return _ref3.apply(this, arguments);\n                    };\n                  }();\n\n                  continueWait =\n                  /*#__PURE__*/\n                  function () {\n                    var _ref4 = _asyncToGenerator(\n                    /*#__PURE__*/\n                    _regeneratorRuntime.mark(function _callee3(wait) {\n                      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                        while (1) {\n                          switch (_context3.prev = _context3.next) {\n                            case 0:\n                              if (unsubscribed) {\n                                _context3.next = 5;\n                                break;\n                              }\n\n                              if (!wait) {\n                                _context3.next = 4;\n                                break;\n                              }\n\n                              _context3.next = 4;\n                              return new Promise(function (resolve) {\n                                return setTimeout(function () {\n                                  return resolve();\n                                }, _this.pollInterval * 1000);\n                              });\n\n                            case 4:\n                              return _context3.abrupt(\"return\", next());\n\n                            case 5:\n                              return _context3.abrupt(\"return\", null);\n\n                            case 6:\n                            case \"end\":\n                              return _context3.stop();\n                          }\n                        }\n                      }, _callee3);\n                    }));\n\n                    return function continueWait(_x3) {\n                      return _ref4.apply(this, arguments);\n                    };\n                  }();\n\n                  _context4.next = 7;\n                  return _this.updateTransportAuthorization();\n\n                case 7:\n                  if (!(response.status === 502)) {\n                    _context4.next = 11;\n                    break;\n                  }\n\n                  _context4.next = 10;\n                  return checkMutex();\n\n                case 10:\n                  return _context4.abrupt(\"return\", continueWait(true));\n\n                case 11:\n                  _context4.next = 13;\n                  return response.json();\n\n                case 13:\n                  body = _context4.sent;\n\n                  if (!(body.error === 'Continue wait')) {\n                    _context4.next = 19;\n                    break;\n                  }\n\n                  _context4.next = 17;\n                  return checkMutex();\n\n                case 17:\n                  if (options.progressCallback) {\n                    options.progressCallback(new ProgressResult(body));\n                  }\n\n                  return _context4.abrupt(\"return\", continueWait());\n\n                case 19:\n                  if (!(response.status !== 200)) {\n                    _context4.next = 32;\n                    break;\n                  }\n\n                  _context4.next = 22;\n                  return checkMutex();\n\n                case 22:\n                  if (!(!options.subscribe && requestInstance.unsubscribe)) {\n                    _context4.next = 25;\n                    break;\n                  }\n\n                  _context4.next = 25;\n                  return requestInstance.unsubscribe();\n\n                case 25:\n                  error = new Error(body.error); // TODO error class\n\n                  if (!callback) {\n                    _context4.next = 30;\n                    break;\n                  }\n\n                  callback(error);\n                  _context4.next = 31;\n                  break;\n\n                case 30:\n                  throw error;\n\n                case 31:\n                  return _context4.abrupt(\"return\", subscribeNext());\n\n                case 32:\n                  _context4.next = 34;\n                  return checkMutex();\n\n                case 34:\n                  if (!(!options.subscribe && requestInstance.unsubscribe)) {\n                    _context4.next = 37;\n                    break;\n                  }\n\n                  _context4.next = 37;\n                  return requestInstance.unsubscribe();\n\n                case 37:\n                  result = toResult(body);\n\n                  if (!callback) {\n                    _context4.next = 42;\n                    break;\n                  }\n\n                  callback(null, result);\n                  _context4.next = 43;\n                  break;\n\n                case 42:\n                  return _context4.abrupt(\"return\", result);\n\n                case 43:\n                  return _context4.abrupt(\"return\", subscribeNext());\n\n                case 44:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        return function loadImpl(_x, _x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      var promise = requestPromise.then(function (requestInstance) {\n        return mutexPromise(requestInstance.subscribe(loadImpl));\n      });\n\n      if (callback) {\n        return {\n          unsubscribe: function () {\n            var _unsubscribe = _asyncToGenerator(\n            /*#__PURE__*/\n            _regeneratorRuntime.mark(function _callee5() {\n              var requestInstance;\n              return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                while (1) {\n                  switch (_context5.prev = _context5.next) {\n                    case 0:\n                      _context5.next = 2;\n                      return requestPromise;\n\n                    case 2:\n                      requestInstance = _context5.sent;\n                      unsubscribed = true;\n\n                      if (!requestInstance.unsubscribe) {\n                        _context5.next = 6;\n                        break;\n                      }\n\n                      return _context5.abrupt(\"return\", requestInstance.unsubscribe());\n\n                    case 6:\n                      return _context5.abrupt(\"return\", null);\n\n                    case 7:\n                    case \"end\":\n                      return _context5.stop();\n                  }\n                }\n              }, _callee5);\n            }));\n\n            function unsubscribe() {\n              return _unsubscribe.apply(this, arguments);\n            }\n\n            return unsubscribe;\n          }()\n        };\n      } else {\n        return promise;\n      }\n    }\n  }, {\n    key: \"updateTransportAuthorization\",\n    value: function () {\n      var _updateTransportAuthorization = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6() {\n        var token;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!(typeof this.apiToken === 'function')) {\n                  _context6.next = 5;\n                  break;\n                }\n\n                _context6.next = 3;\n                return this.apiToken();\n\n              case 3:\n                token = _context6.sent;\n\n                if (this.transport.authorization !== token) {\n                  this.transport.authorization = token;\n                }\n\n              case 5:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function updateTransportAuthorization() {\n        return _updateTransportAuthorization.apply(this, arguments);\n      }\n\n      return updateTransportAuthorization;\n    }()\n    /**\n     * Fetch data for passed `query`.\n     *\n     * ```js\n     * import cubejs from '@cubejs-client/core';\n     * import Chart from 'chart.js';\n     * import chartjsConfig from './toChartjsData';\n     *\n     * const cubejsApi = cubejs('CUBEJS_TOKEN');\n     *\n     * const resultSet = await cubejsApi.load({\n     *  measures: ['Stories.count'],\n     *  timeDimensions: [{\n     *    dimension: 'Stories.time',\n     *    dateRange: ['2015-01-01', '2015-12-31'],\n     *    granularity: 'month'\n     *   }]\n     * });\n     *\n     * const context = document.getElementById('myChart');\n     * new Chart(context, chartjsConfig(resultSet));\n     * ```\n     * @param query - [Query object](query-format)\n     * @param options\n     * @param callback\n     * @returns {Promise} for {@link ResultSet} if `callback` isn't passed\n     */\n\n  }, {\n    key: \"load\",\n    value: function load(query, options, callback) {\n      var _this2 = this;\n\n      return this.loadMethod(function () {\n        return _this2.request(\"load\", {\n          query: query\n        });\n      }, function (body) {\n        return new ResultSet(body);\n      }, options, callback);\n    }\n    /**\n     * Get generated SQL string for given `query`.\n     * @param query - [Query object](query-format)\n     * @param options\n     * @param callback\n     * @return {Promise} for {@link SqlQuery} if `callback` isn't passed\n     */\n\n  }, {\n    key: \"sql\",\n    value: function sql(query, options, callback) {\n      var _this3 = this;\n\n      return this.loadMethod(function () {\n        return _this3.request(\"sql\", {\n          query: query\n        });\n      }, function (body) {\n        return new SqlQuery(body);\n      }, options, callback);\n    }\n    /**\n     * Get meta description of cubes available for querying.\n     * @param options\n     * @param callback\n     * @return {Promise} for {@link Meta} if `callback` isn't passed\n     */\n\n  }, {\n    key: \"meta\",\n    value: function meta(options, callback) {\n      var _this4 = this;\n\n      return this.loadMethod(function () {\n        return _this4.request(\"meta\");\n      }, function (body) {\n        return new Meta(body);\n      }, options, callback);\n    }\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(query, options, callback) {\n      var _this5 = this;\n\n      return this.loadMethod(function () {\n        return _this5.request(\"subscribe\", {\n          query: query\n        });\n      }, function (body) {\n        return new ResultSet(body);\n      }, _objectSpread2({}, options, {\n        subscribe: true\n      }), callback);\n    }\n  }]);\n\n  return CubejsApi;\n}();\n/**\n * Create instance of `CubejsApi`.\n * API entry point.\n *\n * ```javascript\n import cubejs from '@cubejs-client/core';\n\n const cubejsApi = cubejs(\n 'CUBEJS-API-TOKEN',\n { apiUrl: 'http://localhost:4000/cubejs-api/v1' }\n );\n ```\n * @name cubejs\n * @param apiToken - [API token](security) is used to authorize requests and determine SQL database you're accessing.\n * In the development mode, Cube.js Backend will print the API token to the console on on startup.\n * Can be an async function without arguments that returns API token.\n * @param options - options object.\n * @param options.apiUrl - URL of your Cube.js Backend.\n * By default, in the development environment it is `http://localhost:4000/cubejs-api/v1`.\n * @returns {CubejsApi}\n * @order -10\n */\n\n\nvar index = (function (apiToken, options) {\n  return new CubejsApi(apiToken, options);\n});\n\nexports.default = index;\nexports.HttpTransport = HttpTransport;\n"]},"metadata":{},"sourceType":"script"}